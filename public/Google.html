<!DOCTYPE html>
<html lang="ar">

<head>
    <title>New Home | show</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="libraries/bootstrap-5.1.3-dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="libraries/fontawesome-free-6.1.1-web/css/all.min.css" />
    <link rel="stylesheet" href="libraries/bootstrap-5.1.3-dist/css/colors.css" />
    <link rel="stylesheet" href="libraries/swiper/swiper-bundle.min.css">
    <style>
        /*
 * Always set the map height explicitly to define the size of the div element
 * that contains the map.
 */
        #map {
            height: 100%;
        }

        /*
 * Optional: Makes the sample page fill the window.
 */
        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        .infowindow-content {
            width: 300px;
        }

        .title {
            font-size: x-large;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div id="map"></div>

    <!--
    The `defer` attribute causes the callback to execute after the full HTML
    document has been parsed. For non-blocking uses, avoiding race conditions,
    and consistent behavior across browsers, consider loading using Promises
    with https://www.npmjs.com/package/@googlemaps/js-api-loader.
    -->
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB41DRUbKWJHPxaFjMAwdrzWzbVKartNGg&callback=initMap&libraries=localContext&v=beta"
        defer></script>
    <!--=============== SWIPER JS ===============-->
    <script src="libraries/bootstrap-5.1.3-dist/js/jquery-3.6.0.min.js"></script>
    <script src="libraries/bootstrap-5.1.3-dist/js/bootstrap.min.js"></script>
    <script src="libraries/bootstrap-5.1.3-dist/js/bootstrap.bundle.min.js"></script>
    <script src="libraries/swiper/swiper-bundle.min.js"></script>

    <script>

    </script>
    <script>
        let map;
        let infoWindow;
        let infoStorage;
        const districts = {
            a: {
                label: "1",
                location: {
                    lat: 33.489399388203665,
                    lng: 36.312614689791005,
                },
                name: "Central",
                description:
                    "The Central Business District is a hub of economic activity during the day and a destination for great food at night.",
            },
            // b: {
            //     label: "2",
            //     location: {
            //         lat: -1.270955,
            //         lng: 36.810857,
            //     },
            //     name: "Westlands",
            //     description:
            //         "With many high-end restaurants and a vibrant nightlife, Westlands attracts young professionals and their families. ",
            // },
            // c: {
            //     label: "3",
            //     location: {
            //         lat: -1.311868,
            //         lng: 36.838624,
            //     },
            //     name: "South",
            //     description:
            //         "Known for high-rise apartment buildings, South B and South C are in high demand.",
            // },
        };

        function initMap() {
            const localContextMapView = new google.maps.localContext.LocalContextMapView({
                element: document.getElementById("map"),

                placeTypePreferences: [
                    { type: "bakery", weight: 1 },
                    { type: "bank", weight: 1 },
                    { type: "cafe", weight: 2 },
                    { type: "department_store", weight: 1 },
                    { type: "drugstore", weight: 1 },
                    { type: "park", weight: 3 },
                    { type: "restaurant", weight: 2 },
                    { type: "primary_school", weight: 3 },
                    { type: "secondary_school", weight: 3 },
                    { type: "supermarket", weight: 2 },
                ],
                maxPlaceCount: 100,
            });

            map = localContextMapView.map;
            map.setOptions({
                center: districts["a"].location,
                zoom: 13,
            });

            // Add 3 custom markers that open InfoWindows on click
            for (const key in districts) {
                const district = districts[key];
                const marker = new google.maps.Marker({
                    label: district.label,
                    position: district.location,
                    map: map,
                    zIndex: 30,
                });

                marker.addListener("click", () => {
                    // Close any open details or existing InfoWindows
                    localContextMapView.hidePlaceDetailsView();
                    if (infoWindow) {
                        infoWindow.close();
                    }

                    // Create and open a new InfoWindow
                    createInfoWindow(district, marker);
                    // Define origin as the selected marker position
                    localContextMapView.directionsOptions = {
                        origin: district.location,
                    };
                });
            }

            // Set the LocalContextMapView event handlers.
            localContextMapView.addListener("placedetailsviewshowstart", () => {
                if (infoWindow) {
                    infoWindow.close();
                }
            });
            localContextMapView.addListener("placedetailsviewhidestart", () => {
                if (infoStorage) {
                    createInfoWindow(infoStorage.district, infoStorage.marker);
                }
            });
        }

        // Creates an infoWindow and also stores information associated with the
        // InfoWindow so the InfoWindow can be restored after it has been closed
        // by non-user-initiated events.
        function createInfoWindow(district, marker) {
            // Build the content of the InfoWindow
            const contentDiv = document.createElement("div");
            const nameDiv = document.createElement("div");
            const descriptionDiv = document.createTextNode(district.description);

            contentDiv.classList.add("infowindow-content");
            nameDiv.classList.add("title");
            nameDiv.textContent = district.name;
            descriptionDiv.textContent = district.description;
            contentDiv.appendChild(nameDiv);
            contentDiv.appendChild(descriptionDiv);
            // Create and open a new InfoWindow
            infoWindow = new google.maps.InfoWindow();
            infoWindow.setContent(contentDiv);
            infoWindow.open(map, marker);
            // Store key properties of the InfoWindow for future restoration
            infoStorage = {
                district: district,
                marker: marker,
            };
            // Clear content storage if infoWindow is closed by the user
            infoWindow.addListener("closeclick", () => {
                if (infoStorage) {
                    infoStorage = null;
                }
            });
        }

        window.initMap = initMap;
    </script>
</body>

</html>
